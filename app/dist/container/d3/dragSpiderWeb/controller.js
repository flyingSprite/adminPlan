define(["adminApp","d3"],function(r,t){r.controller("D3DragSpiderWebController",function(r,a){function e(r,t,a){for(var e=r.branchs,n=r.nodes,o=[],s=0;a>s;s++)for(var l=0;t>l;l++){var p=0===s?{x:0,y:0}:n[s-1][l],h=n[s][l],d=i(p,h);o.push(d)}for(var c=n[n.length-1],l=0;t>l;l++){var p=c[l],h=e[l],d=i(p,h);o.push(d)}}function n(r){for(var t=r.nodes,a=[],e=0;e<t.length;e++){for(var n=t[e],o=n[0],s=!0,l=0;l<n.length;l++){var p=n[l];if(s)s=!1;else{var h=i(o,p);o=p,a.push(h)}}var h=i(n[0],n[n.length-1])}}function o(r){for(var t=r.nodes,a=[],e=0;e<t.length;e++)a=a.concat(t[e]);for(var n=[],e=0;e<a.length;e++){var o=s(a[e]);n.push(o)}}function s(r){var t={positition:r,point:v.append("circle").attr("class","node-dashednet").attr("cx",r.x).attr("cy",r.y).attr("r",5)};return t}function i(r,t){var a={one:r,two:t,path:v.append("polyline").attr("points",[[r.x,r.y],[t.x,t.y]])};return a}function l(r,t,a,e,n){for(var o={center:{x:0,y:0},branchs:[],nodes:[]},s=0;r>s;s++){var i=2*Math.PI/r*s,l={x:t*Math.cos(i),y:t*Math.sin(i)};o.branchs.push(l)}for(var s=0;n>s;s++){for(var p=[],h=e*s+a,d=0;r>d;d++){var i=2*Math.PI/r*d,c={x:h*Math.cos(i),y:h*Math.sin(i)};p.push(c)}o.nodes.push(p)}return o}a.title="D3",a.subTitle="Drag Spider Web";var p=this;p.title="Drag Spider Web",p.markTemplate="marks/d3/dragSpiderWeb.md",p.info="使用d3绘制一个虚拟的蜘蛛网，并实现拖拽的功能";var h=t.select("#d3select").append("svg").style("width","100%").style("height","100%").style("color","#777"),d=parseInt(h.style("width").replace("px","")),c=parseInt(h.style("height").replace("px","")),v=h.append("g").attr("transform","translate("+d/2+", "+c/2+")"),f=12,u=c/2,g=40,y=30,x=(u-g)/y,b=l(f,u,g,y,x);e(b,f,x),n(b),o(b);var m=d/2,M=c/2,D=t.behavior.drag().on("drag",function(r){m+=t.event.dx,M+=t.event.dy,v.attr("transform","translate("+m+", "+M+")")});h.call(D)})});