define(["adminApp","pnotify"],function(t){t.controller("DocsWikiController",["$state","$stateParams","breadcrumb","api","copyArray","removeArrayById",function(t,n,e,o,i,c){function d(){a.id=n.id,o.doc.getSubjectById(a.id,function(t){t&&200===t.code&&t.data&&(a.docSubject=t.data)}),o.doc.getTitle(a.id,function(t){t&&200===t.code&&t.data&&(a.titles.length=0,i(a.titles,t.data),a.initFirstLoad())})}e("Wiki",[{name:"Document",link:"main.docs.subject"},{name:"Subject",link:"main.docs.subject"},{name:"Wiki",link:"main.docs.wiki"}]);var a=this;a.titles=[],a.selectTitle={},a.docContent={},a.hasDocContent=!1,a.isEditDocContent=!1,a.apboxOptions=[{name:"Edit"}],a.editorOptions={lineWrapping:!0,lineNumbers:!0,mode:"markdown"},a.toCreateNewTitle=function(){a.newTitle&&a.id&&o.doc.postTitle({subjectId:a.id,title:a.newTitle,author:"Quesle"},function(t){t&&200===t.code&&t.data&&(a.newTitle="",a.titles.push(t.data))})},a.initFirstLoad=function(){if(a.titles.length>0){var t=a.titles[0];a.showDocContent(t)}},a.deleteTitle=function(t){o.doc.deleteTitle(t.id,function(n){n&&200===n.code&&c(a.titles,t)})},a.showDocContent=function(t){a.selectTitle=t,a.isEditDocContent=!1,o.doc.getContent(a.selectTitle.id,function(t){t&&200===t.code&&t.data?(a.docContent=t.data,a.hasDocContent=!0):(a.docContent={},a.hasDocContent=!1)})},a.toEditDocContent=function(){a.isEditDocContent=!0,a.hasDocContent&&(a.editContent=a.docContent.content)},a.cancelEditDocContent=function(){a.isEditDocContent=!1,a.editContent=""},a.editDocContent=function(){if(a.docContent.content=a.editContent,a.editContent){var t,n={subjectId:a.id,titleId:a.selectTitle.id,content:a.editContent,title:a.selectTitle.title,author:"Quesle"};a.hasDocContent?(n.id=a.docContent.id,t=o.doc.putContent):t=o.doc.postContent,t(n,function(t){t&&200===t.code&&t.data&&(a.docContent=t.data,a.isEditDocContent=!1)})}},d()}])});